(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{613:(e,a,t)=>{"use strict";t.d(a,{Ak:()=>A,Ay:()=>h,Ir:()=>c,Zv:()=>n,lJ:()=>g});var i=t(1990);let n=(0,i.zD)("list/fetchList",async(e,a)=>{let{rejectWithValue:t}=a,{page:i,itemsPerPage:n=10}=e;try{let e=await fetch("https://api-test.rtbpanda.tech/list?page=".concat(i,"&itemsPerPage=").concat(n),{headers:{"Content-Type":"application/json"},signal:AbortSignal.timeout(1e4)});if(!e.ok)throw Error("HTTP ".concat(e.status,": ").concat(e.statusText));let a=await e.json();if(!a.data||!Array.isArray(a.data))throw Error("Некорректная структура данных");return a}catch(a){let e="Неизвестная ошибка";return a instanceof Error&&(e="TimeoutError"===a.name?"Превышено время ожидания запроса":"AbortError"===a.name?"Запрос был отменен":a.message),t(e)}}),r=(0,i.Z0)({name:"list",initialState:{items:[],loading:!0,error:null,page:1,total:0,itemsPerPage:10,loadingMode:"pagination",hasMore:!0},reducers:{setLoading:(e,a)=>{e.loading=a.payload},setError:(e,a)=>{e.error=a.payload},setItems:(e,a)=>{e.items=a.payload},appendItems:(e,a)=>{e.items=[...e.items,...a.payload]},setPage:(e,a)=>{e.page=a.payload},setItemsPerPage:(e,a)=>{e.itemsPerPage=a.payload,e.page=1,e.items=[]},setLoadingMode:(e,a)=>{e.loadingMode=a.payload,e.page=1,e.items=[],"infinite"===a.payload&&(e.itemsPerPage=10)},setHasMore:(e,a)=>{e.hasMore=a.payload}},extraReducers:e=>{e.addCase(n.pending,e=>{e.loading=!0,e.error=null}).addCase(n.fulfilled,(e,a)=>{e.loading=!1,"infinite"===e.loadingMode&&e.page>1?e.items=[...e.items,...a.payload.data]:e.items=a.payload.data,e.total=a.payload.meta.count,e.hasMore=a.payload.data.length===e.itemsPerPage}).addCase(n.rejected,(e,a)=>{e.loading=!1,e.error=a.payload})}}),{setLoading:o,setError:s,setItems:l,appendItems:d,setPage:c,setItemsPerPage:g,setLoadingMode:A,setHasMore:p}=r.actions,h=r.reducer},881:e=>{e.exports={container:"VirtualizedCardList_container__iO08r",row:"VirtualizedCardList_row__N7Snh",cardWrapper:"VirtualizedCardList_cardWrapper__V0UmN",loadingRow:"VirtualizedCardList_loadingRow__RnEeX"}},3471:e=>{e.exports={container:"CardList_container__e2lMj",grid:"CardList_grid__Tb6cg",spinner:"CardList_spinner__gQedN",pagination:"CardList_pagination__PJky_",loadingMore:"CardList_loadingMore__ApX5d",endMessage:"CardList_endMessage__4zhDz","ant-pagination-item":"CardList_ant-pagination-item__tzPsP","ant-pagination-prev":"CardList_ant-pagination-prev__suS7r","ant-pagination-next":"CardList_ant-pagination-next__44Foe","ant-pagination-jump-prev":"CardList_ant-pagination-jump-prev__YA66z","ant-pagination-jump-next":"CardList_ant-pagination-jump-next__WPYvu","ant-pagination-total-text":"CardList_ant-pagination-total-text__dyIzE","ant-pagination-options":"CardList_ant-pagination-options__LJMSY"}},3679:e=>{e.exports={card:"Card_card__8D28t",fixedHeight:"Card_fixedHeight__xFa6T",imageContainer:"Card_imageContainer__IiRdx",image:"Card_image__Zhmhl",placeholder:"Card_placeholder__6u4V2",placeholderIcon:"Card_placeholderIcon__aMRQc",date:"Card_date__F_ZzO"}},4277:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>y});var i=t(5155),n=t(9667),r=t(6467),o=t(1154),s=t(2115),l=t(4540);let d=function(e,a,t){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,n=(0,s.useCallback)(()=>{if(a||!e)return;let n=document.documentElement.scrollTop||document.body.scrollTop,r=document.documentElement.scrollHeight||document.body.scrollHeight;n+document.documentElement.clientHeight>=r-i&&t()},[a,e,t,i]);return(0,s.useEffect)(()=>(window.addEventListener("scroll",n,{passive:!0}),()=>{window.removeEventListener("scroll",n)}),[n]),{checkScrollPosition:n}};var c=t(613),g=t(3471),A=t.n(g),p=t(544),h=t(8552),m=t(6766),u=t(3679),_=t.n(u);let{Meta:C}=h.A,x=e=>{let{item:a,loadingMode:t="pagination"}=e,[n,r]=(0,s.useState)(!1),o="".concat(_().card," ").concat("infinite"===t?_().fixedHeight:"");return(0,i.jsx)(h.A,{className:o,cover:!a.imgUrl||n?(0,i.jsx)("div",{className:_().placeholder,children:(0,i.jsx)(p.A,{className:_().placeholderIcon})}):(0,i.jsx)("div",{className:_().imageContainer,children:(0,i.jsx)(m.default,{src:a.imgUrl,alt:a.title,width:320,height:180,className:_().image,placeholder:"blur",blurDataURL:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAhEAACAQMDBQAAAAAAAAAAAAABAgMABAUGIWGRkqGx0f/EABUBAQEAAAAAAAAAAAAAAAAAAAMF/8QAGhEAAgIDAAAAAAAAAAAAAAAAAAECEgMRkf/aAAwDAQACEQMRAD8AltJagyeH0AthI5xdrLcNM91BF5pX2HaH9bcfaSXWGaRmknyJckliyjqTzSlT54b6bk+h0R+IRUIj",priority:!1,loading:"lazy",onError:()=>{r(!0)}})}),extra:(0,i.jsx)("small",{className:_().date,children:(e=>{let a=new Date(e);return isNaN(a.getTime())?e:a.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})(a.date)}),title:a.title,hoverable:!0,children:(0,i.jsx)(C,{description:a.message})})};var w=t(881),v=t.n(w);let f=e=>{let{items:a,hasMore:t,onLoadMore:n}=e,[o,l]=(0,s.useState)(0),[d,c]=(0,s.useState)(0),[g,A]=(0,s.useState)(0),[p,h]=(0,s.useState)(0),m=(0,s.useMemo)(()=>(e=>e<=480?1:e<=768?2:e<=1200?3:4)(p),[p]),u=(0,s.useMemo)(()=>{let e=[];for(let t=0;t<a.length;t+=m)e.push(a.slice(t,t+m));return e},[a,m]),_=375*u.length+375*!!t;(0,s.useEffect)(()=>{let e=()=>{let e=document.querySelector("[data-virtualized-container]");e&&c(e.getBoundingClientRect().top+window.scrollY),A(window.innerHeight),h(window.innerWidth)},a=()=>{l(window.scrollY)};return e(),window.addEventListener("scroll",a,{passive:!0}),window.addEventListener("resize",e),()=>{window.removeEventListener("scroll",a),window.removeEventListener("resize",e)}},[]);let{startIndex:C,endIndex:w,visibleRows:f}=(0,s.useMemo)(()=>{let e=o+g;if(d+_<o||d>e)return{startIndex:0,endIndex:-1,visibleRows:[]};let a=Math.max(0,o-d),t=Math.min(_,e-d),i=Math.max(0,Math.floor(a/375)-2),n=Math.min(u.length-1,Math.ceil(t/375)+2);return{startIndex:i,endIndex:n,visibleRows:u.slice(i,n+1)}},[o,d,g,_,u]),j=(0,s.useCallback)(()=>{t&&w>=u.length-3&&n()},[t,w,u.length,n]);return(0,s.useEffect)(()=>{j()},[j]),(0,i.jsxs)("div",{className:v().container,"data-virtualized-container":!0,style:{height:_},children:[f.map((e,a)=>{let t=C+a;return(0,i.jsx)("div",{className:v().row,style:{top:375*t,height:375},children:e.map((e,a)=>(0,i.jsxs)("div",{className:v().cardWrapper,children:[(0,i.jsx)(x,{item:e,loadingMode:"infinite"})," "]},"".concat(e.id,"-").concat(t,"-").concat(a)))},t)}),t&&w>=u.length-1&&(0,i.jsx)("div",{className:v().loadingRow,style:{top:375*u.length,height:375},children:(0,i.jsx)(r.A,{})})]})},j=()=>{let e=(0,l.wA)(),{items:a,loading:t,error:g,page:p,total:h,itemsPerPage:m,loadingMode:u,hasMore:_}=(0,l.d4)(e=>e.list);(0,s.useEffect)(()=>{0===a.length&&e((0,c.Zv)({page:1,itemsPerPage:m}))},[e,u,a.length,m]),(0,s.useEffect)(()=>{"pagination"===u&&p>1&&e((0,c.Zv)({page:p,itemsPerPage:m}))},[e,p,u,m]);let C=(a,t)=>{t&&t!==m?(e((0,c.lJ)(t)),e((0,c.Zv)({page:1,itemsPerPage:t}))):e((0,c.Ir)(a))},w=(0,s.useCallback)(()=>{if(!t&&_&&"infinite"===u){let a=p+1;e((0,c.Ir)(a)),e((0,c.Zv)({page:a,itemsPerPage:m}))}},[e,t,_,u,p,m]);return(d(_,t,w),g)?(0,i.jsx)(n.A,{type:"error",message:g}):t&&0===a.length?(0,i.jsx)("div",{className:A().spinner,children:(0,i.jsx)(r.A,{size:"large"})}):t||0!==a.length?(0,i.jsx)("div",{className:A().container,children:"infinite"===u?(0,i.jsx)(f,{items:a,hasMore:_,onLoadMore:w}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:A().grid,children:a.map((e,a)=>(0,i.jsx)(x,{item:e,loadingMode:u},"".concat(e.id,"-").concat(a)))}),h>m&&(0,i.jsx)("div",{className:A().pagination,children:(0,i.jsx)(o.A,{current:p,total:h,pageSize:m,onChange:C,onShowSizeChange:C,showSizeChanger:!0,pageSizeOptions:["5","10","20","50"],showQuickJumper:!0,showTotal:(e,a)=>"".concat(a[0],"-").concat(a[1]," из ").concat(e," элементов"),responsive:!0})})]})}):(0,i.jsx)("div",{className:A().container,children:(0,i.jsx)(n.A,{type:"info",message:"Нет данных",showIcon:!0})})};function y(){return(0,i.jsx)("main",{children:(0,i.jsx)(j,{})})}t(1231)},8201:(e,a,t)=>{Promise.resolve().then(t.bind(t,4277))}},e=>{e.O(0,[146,262,716,769,871,441,964,358],()=>e(e.s=8201)),_N_E=e.O()}]);